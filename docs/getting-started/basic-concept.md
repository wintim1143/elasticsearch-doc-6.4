# 入门

### 基础概念

elasticsearch有一些核心概念，从一开始就理解这些概念将极大地帮助简化学习过程。

#### 近实时（NRT）

elasticsearch是一个近实时的搜索平台。也就是说从为文档建立索引，到这个文档可查询，是存在轻微延迟的（一般在1秒钟以内）。

#### 集群（Cluster）

集群是一个或多个节点（服务器）的集合，他们共同存储整个数据，并提供跨所有节点的联合索引和搜索功能。集群由唯一名称标识，默认名称是`elasticsearch`。这个标识很重要，节点会根据这个标识加入一个集群。

确保不要在不同的环境中使用相同的集群名称，这会导致节点加入错误的集群。例如，你可以实用类似`logging-dev`,`logging-stage`

和`logging-prod`等名称标识开发，测试和生产集群。

注意：如果一个集群只有一个节点也是完全可行的，此外你也可以建立多个独立的集群，每个集群有自己的唯一标识。

#### 节点（Node）

节点是组成集群的一个独立服务，用于存储集群数据并为集群提供索引和搜索能力。和集群一样， 每个节点也有一个唯一标识，在节点启动的时候会默认分配给它一个随机通用唯一标识\(UUID\)。你也可以自定义节点标识，以代替默认标识。在集群的管理中，可以使用节点标识来对应网络中的服务器名称。

节点可以根据配置的集群标识加入指定的集群。一般来说，每个节点在启动之后会默认加入一个叫`elasticsearch`的集群。假如在一个节点可以相互发现对方的网络环境中，启动多个节点，他们会自动加入到一个标识为`elasticsearch`的集群。

在一个独立的集群中，你可以建立任意个数的节点。此外，如果当前网络环境中没有其他的`elasticsearch`节点在运行，那么单独启动一个节点会形成一个单节点的集群，其集群标识为`elasticsearch`

#### 索引（index）

索引是拥有相同特征的文档（document）的集合。例如，为客户数据建立索引，为产品目录建立索引，也可以为订单数据建立索引。用名称来标识一个索引（必须全部小写），在对索引中的文档进行索引（indexing），查询，更新，删除操作时需要引用索引名称。

#### 类型（type）

##### warning  :在6.0.0中弃用

类型曾经被用作索引的逻辑类别或分区，在同一个索引中可以存储不同类型的文档。例如：一种类型用于用户，另一种类型用于博客帖子。现在不可以在同一个索引中建立多个类型，并且类型的概念在以后的版本中会被移除。详见[_Removal of mapping types_](https://www.elastic.co/guide/en/elasticsearch/reference/current/removal-of-types.html)

#### 文档（document）

文档是可以被索引的基础单元。例如，一个客户信息是一个文档，或者一个产品信息是一个文档，又或者一个订单信息是一个文档。文档使用JSON（JavaScript Object Notation：互联网交换数据的普遍格式）格式表示。

在索引或者类型中可以存储任意多的文档。尽管文档实际存储在索引中，但是使用中必须把文档编入或者分配到一个索引的类型中。

#### 分片和副本（shards&replicas）

一个索引`index`可能会存储大量的数据，大到超过一个节点的存储能力。例如：一个占用1T磁盘存储空间的索引，对单节点来说可能会太大，或者造成查询请求太慢。

分片（shards）就是为了解决上面的问题，elasticsearch提供了将一个索引数据存储在多个分片上的功能。在新建一个索引时，可以指定索引的分片数量。每个分片（shard）具备全部索引功能且独立，它们会被分布到集群中的多个节点中。

分片很重要，主要解决下面两个问题：

* 水平扩展/收缩你的集群容量

* 跨分片（可能在多个节点上）的分布和并行操作，可以提升吞吐量性能

分片的分布方式和如何聚合文档回搜索请求的机制，是完全由elasticsearch管理的，他们对用户是透明的。

在一个随时可能发生故障的的网络或者云环境中，为防止分片或者节点以任何原因脱机或者消失，拥有故障转移的机制是非常有用的。为此，elasticsearch支持对索引分片建立一个或多个拷贝，我们称之为分片副本，简称副本。

副本很重要，主要是下面两个原因：

* 在分片或节点发生故障时提供高可用性。因此，一个副本不会与它的拷贝主体（original/primary shard）在同一个节点上。
* 扩展搜索量吞吐能力，因为可以并行的在所有副本上进行搜索。

总而言之，每个索引可以拆分成多个分片，索引分片可以拥有零个（不含副本）或多个副本。生成副本后，每个索引会区分出主索引（primary shards:被复制的分片）和副本分片（replica shards:复制的分片）

分片数和副本数可以在一个索引被新建的时候指定。在索引建立之后，可以随时动态变更副本数量。可以使用`_shrink`和_ _`_splite`APIS 修改现有索引的分片数量，但是这个不被推荐，最好的实践方案是提前预估分片数量。

在elsaticsearch中，默认每个索引会被分配5个主索引和1个备份。也就是说如果一个拥有两个节点的集群，每个索引会拥有5个主分片和5个副本分片，一共10个分片。

**NOTE:**

每个elasticsearch分片都是一个Lucene索引。一个Lucene索引包含的文档数是有限制的，最多包含`2,147,483,519`\(= Integer.MAX\_VALUE - 128\) 。你可以使用[`_cat/shards`](https://www.elastic.co/guide/en/elasticsearch/reference/6.4/cat-shards.html)API来监控分片的大小。

